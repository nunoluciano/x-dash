<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Gatsby 2.0.114"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/x-dash/0-dcdb640fb910f8619568.js"/><link as="script" rel="preload" href="/x-dash/component---src-templates-npm-package-jsx-4ed2498fa94a50fc81ff.js"/><link as="script" rel="preload" href="/x-dash/app-f908e434cdcecf094632.js"/><link as="script" rel="preload" href="/x-dash/webpack-runtime-57aa0895b31d9a853c37.js"/><link as="fetch" rel="preload" href="/x-dash/static/d/745/path---components-x-interaction-e-68-744-XRHBJxlSnzFGIB1o032kBBT5p8.json" crossOrigin="use-credentials"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700"/><link rel="stylesheet" href="/x-dash/main.css"/><link rel="stylesheet" href="/x-dash/prism.css"/><link rel="icon" href="/favicon.ico"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="basic-layout"><div class="basic-layout__header"><header class="site-header"><div class="site-header__masthead"><a href="/x-dash/">x-dash</a></div><img class="site-header__logo" src="/x-dash/logo.png" alt=""/><nav role="navigation" class="site-header__menu"><a href="/x-dash/docs">Docs</a><a href="/x-dash/components">Components</a><a href="/x-dash/packages">Packages</a></nav></header></div><div class="basic-layout__content"><div class="content-layout"><main class="content-layout__main" role="main"><div class="content-layout__main-inner"><div class="markdown"><h1 id="x-interaction"><a href="#x-interaction" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x-interaction</h1>
<p>This module enables you to write x-dash components that respond to events and change their own data.</p>
<h2 id="installation"><a href="#installation" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<p>This module is compatible with Node 6+ and is distributed on npm.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save @financial-times/x-interaction</code></pre></div>
<p><code class="language-text">x-interaction</code> is intended to be used internally in <code class="language-text">x-dash</code> components, instead of as a dependency of your application.</p>
<h2 id="writing-interactive-components"><a href="#writing-interactive-components" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing interactive components</h2>
<p>The main interface of <code class="language-text">x-interaction</code> is the function <code class="language-text">withActions</code>, which can be used to wrap ordinary (i.e. <em>stateless</em>) x-dash components.</p>
<h3 id="actions"><a href="#actions" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Actions</h3>
<p>An action is a function that's passed to a component, intended to be used in an event handler. Each action returns a <em>state update</em>, which can be either an object to be merged into the properties of the component, or a function that's called with the <em>current</em> properties and should return an object to be merged in:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span>withActions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> greetingActions <span class="token operator">=</span> <span class="token function">withActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">actionOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>greeting<span class="token punctuation">:</span> <span class="token string">"world"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function">actionTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
			greeting<span class="token punctuation">:</span> greeting<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Greeting <span class="token operator">=</span> <span class="token function">greetingActions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token punctuation">,</span> actions<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
	hello </span><span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actions<span class="token punctuation">.</span>actionOne<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">"world"</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actions<span class="token punctuation">.</span>actionTwo<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">uppercase</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Clicking the first button will set the greeting to <code class="language-text">&quot;world&quot;</code>, and clicking the second button sets the greeting to whatever it was previously, in uppercase. Returning a function from your action is the only way to have the updated state depend on the previous state.</p>
<h3 id="asynchronous-actions"><a href="#asynchronous-actions" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Asynchronous actions</h3>
<p>If an action returns a Promise (e.g. if it's an <code class="language-text">async</code> function), <code class="language-text">x-interaction</code> will wait for the promise and use the value it resolves to as the state update, and set the property <code class="language-text">isLoading</code> to <code class="language-text">true</code> while the promise is in-flight:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span>withActions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> greetingActions <span class="token operator">=</span> <span class="token function">withActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token keyword">async</span> <span class="token function">updateGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> repsonse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/greeting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span>greeting<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Greeting <span class="token operator">=</span> <span class="token function">greetingActions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> isLoading<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
	hello </span><span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actions<span class="token punctuation">.</span>updateGreeting<span class="token punctuation">}</span></span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isLoading<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
		</span><span class="token punctuation">{</span>isLoading <span class="token operator">?</span> <span class="token string">'loading greeting...'</span> <span class="token punctuation">:</span> <span class="token string">'update greeting'</span><span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="properties-in-actions"><a href="#properties-in-actions" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Properties in actions</h3>
<p>If you need access to the properties of the component <em>before</em> returning the state update, for example if your component needs to send parameters to an endpoint, you can pass a function to <code class="language-text">withActions</code> in place of the actions object. Your function will be called with the <em>initial</em> properties of the component, and should return an actions object:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span>withActions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> greetingActions <span class="token operator">=</span> <span class="token function">withActions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>lang<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token keyword">async</span> <span class="token function">updateGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> repsonse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/greeting?lang=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span>greeting<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Greeting <span class="token operator">=</span> <span class="token function">greetingActions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> isLoading<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
	hello </span><span class="token punctuation">{</span>greeting<span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actions<span class="token punctuation">.</span>updateGreeting<span class="token punctuation">}</span></span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isLoading<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
		</span><span class="token punctuation">{</span>isLoading <span class="token operator">?</span> <span class="token string">'loading greeting...'</span> <span class="token punctuation">:</span> <span class="token string">'update greeting'</span><span class="token punctuation">}</span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><em>These properties will not change when the state updates</em>, so they should not be used to have state that depends on previous state; use a state update function for this.</p>
<h3 id="wrapped-and-unwrapped-components"><a href="#wrapped-and-unwrapped-components" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wrapped and unwrapped components</h3>
<p>Because the actions are separate from the components, the base component can usually be used as a static component without the wrapper. This is useful in case a consumer of the component needs to provide its own actions. It's recommended to export the wrapped component, the base component, and the actions as separate named exports. The naming convention for these is <code class="language-text">ComponentName</code>, <code class="language-text">BaseComponentName</code> and <code class="language-text">componentNameActions</code>, for example:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>withActions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> greetingActions <span class="token operator">=</span> <span class="token function">withActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">BaseGreeting</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token punctuation">,</span> actions<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
	hello <span class="token punctuation">{</span>greeting<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Greeting <span class="token operator">=</span> <span class="token function">greetingActions</span><span class="token punctuation">(</span>BaseGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="hydrating-server-rendered-markup"><a href="#hydrating-server-rendered-markup" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hydrating server-rendered markup</h3>
<p>When you have an <code class="language-text">x-interaction</code> component rendered by the server, and you want to attach the client-side version of the component to handle the actions, rather than rendering the component manually (which might become unwieldy, especially if you have many components &#x26; instances on the page), you can have <code class="language-text">x-interaction</code> manage it for you.</p>
<p>There are two parts to this: serialising and hydrating.</p>
<h4 id="serialising"><a href="#serialising" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serialising</h4>
<p>To ensure components are rendered with the same initial data on the client side, and keep track of all the instances that are rendered and their identifiers, <code class="language-text">x-interaction</code> exports a <code class="language-text">Serialiser</code> class. You <em>must</em> create a new instance at the start every HTTP request that responds with any number of <code class="language-text">x-interaction</code> components.</p>
<p>This instance should be passed to every <code class="language-text">x-interaction</code> component you render, as a property called <code class="language-text">serialiser</code>. This will add the component's properties to the data to be sent to the client (the "hydration data").</p>
<p>Finally, after every <code class="language-text">x-interaction</code> component is rendered, you should output the hydration data. <code class="language-text">x-interaction</code> exports a <code class="language-text">HydrationData</code> component, which takes a serialiser as a property and renders a <code class="language-text">&lt;script&gt;</code> tag containing its hydration data, assigned to a global variable that can be picked up by the <code class="language-text">x-interaction</code> client-side runtime. A serialiser cannot be used again after its data has been output by a <code class="language-text">HydrationData</code> component.</p>
<p>Here's a full example of using <code class="language-text">Serialiser</code> and <code class="language-text">HydrationData</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Serialiser<span class="token punctuation">,</span> HydrationData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-increment'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> serialiser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Serialiser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
		</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> serialiser <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)}
		</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">HydrationData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> serialiser <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)}
	`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h4 id="hydrating"><a href="#hydrating" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hydrating</h4>
<p>When rendered on the server side, components output an extra wrapper element, with a <code class="language-text">data-x-dash-id</code> attribute. This is used by the <code class="language-text">x-interaction</code> runtime to identify the component in serialisation data, and attach the correct instance to it on the client side. You can pass this in as the <code class="language-text">id</code> property when rendering the component; otherwise, an identifier will be randomly generated.</p>
<p><code class="language-text">x-interaction</code> exports a function <code class="language-text">hydrate</code>. This should be called on the client side. It inspects the global serialisation data on the page, uses the identifiers to find the wrapper elements, and calls <code class="language-text">render</code> from your chosen <code class="language-text">x-engine</code> client-side runtime to render component instances into the wrappers.</p>
<p>Before calling <code class="language-text">hydrate</code>, you must first <code class="language-text">import</code> any <code class="language-text">x-interaction</code> components that will be rendered on the page. The components register themselves with the <code class="language-text">x-interaction</code> runtime when imported; you don't need to do anything with the imported component. This will also ensure the component is included in your client-side bundle.</p>
<p>Because <code class="language-text">hydrate</code> expects the wrappers to be present in the DOM when called, it should be called after <a href="https://developer.mozilla.org/en-US/docs/Web/Events/DOMContentLoaded" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">DOMContentLoaded</code></a>. Depending on your page structure, it might be appropriate to hydrate the component when it's scrolled into view.</p>
<p>A full example of client-side code for hydrating components:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-interaction'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'@financial-times/x-increment'</span><span class="token punctuation">;</span> <span class="token comment">// bundle x-increment and register it with x-interaction</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> hydrate<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="triggering-actions-externally"><a href="#triggering-actions-externally" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Triggering actions externally</h3>
<h4 id="client-side-rendering"><a href="#client-side-rendering" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client-side rendering</h4>
<p>When using a client-side runtime, such as React, to render an <code class="language-text">x-interaction</code> component, you can pass a property <code class="language-text">actionsRef</code> to the component. This should be a function which will be called with a reference to the component instance's actions when the component is mounted, and <code class="language-text">null</code> when it's unmounted. This is similar to React's <a href="https://reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">ref</code> property</a> for obtaining references to DOM elements.</p>
<p>You can call these action references from anywhere in your app, and they'll be scoped to the component instance you obtained the reference from. This allows external events, such as from components not in x-dash, or third-party components you don't control, to trigger state changes in your component. You can also use this functionality to trigger initialisation logic on a component, for example when it is scrolled into view.</p>
<p>Here's an example of triggering an <code class="language-text">x-increment</code> component's <code class="language-text">increment</code> action from a button outside the component:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-engine'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@financial-times/x-increment'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExternalActionDemo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>incrementActions <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>incrementActions<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
				Increment externally
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">

			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Increment</span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span> <span class="token attr-name">actionsRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actions <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>incrementActions <span class="token operator">=</span> actions<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h4 id="server-side-rendering"><a href="#server-side-rendering" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server-side rendering</h4>
<p>When your component has been rendered by <a href="#hydrating-server-rendered-markup"><code class="language-text">x-interaction</code> client-side hydration</a>, you don't have access to the component instance, so you can't use <code class="language-text">actionsRef</code>. In this scenario, <code class="language-text">x-interaction</code> supports triggering actions via a <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent" target="_blank" rel="nofollow noopener noreferrer">DOM Custom Event</a>.</p>
<p>The event is called <code class="language-text">x-interaction.trigger-action</code>, and should be dispatched on the wrapper element of the component instance you want to trigger an action on. The wrapper has the attribute <code class="language-text">data-x-dash-id</code>, which you can use in a selector, but because the randomly-generated default <code class="language-text">id</code> is unpredictable, you should render the component with a unique, static <code class="language-text">id</code>. On the server side:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
	</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token string">'x-interaction-1'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)}
	</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getInteractionData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>And the client side:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[data-x-dash-id="x-interaction-1"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the <code class="language-text">detail</code> parameter of the event, include a property <code class="language-text">action</code>, which is the name of the action to trigger. You can also specify a property <code class="language-text">args</code>, which should be an array that will be passed to the action as its arguments:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">wrapper<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>
	<span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>
		<span class="token string">'x-interaction.trigger-action'</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> detail<span class="token punctuation">:</span> <span class="token punctuation">{</span> action<span class="token punctuation">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> amount<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></div></div></main><div class="content-layout__tertiary"><div class="content-layout__tertiary-inner"><div class="tertiary-menu"><p class="tertiary-menu__heading">Quick links:</p><ul class="tertiary-menu__list"><li class="tertiary-menu__item"><a href="https://www.npmjs.com/package/@financial-times/x-interaction" rel="noopener noreferrer" target="_blank">NPM</a></li><li class="tertiary-menu__item"><a href="https://github.com/Financial-Times/x-dash/tree/master/components/x-interaction" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div><div class="tertiary-menu"><p class="tertiary-menu__heading">On this page:</p><ul class="tertiary-menu__list"><li class="tertiary-menu__item" style="padding-left:0em"><a href="#installation">Installation</a></li><li class="tertiary-menu__item" style="padding-left:0em"><a href="#writing-interactive-components">Writing interactive components</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#actions">Actions</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#asynchronous-actions">Asynchronous actions</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#properties-in-actions">Properties in actions</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#wrapped-and-unwrapped-components">Wrapped and unwrapped components</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#hydrating-server-rendered-markup">Hydrating server-rendered markup</a></li><li class="tertiary-menu__item" style="padding-left:1em"><a href="#triggering-actions-externally">Triggering actions externally</a></li></ul></div></div></div></div></div><div class="basic-layout__sidebar"><div class="site-sidebar"><ul class="site-sidebar__list site-sidebar__list--sticky"><li class="site-sidebar__item site-sidebar__item--heading">components</li><li class="site-sidebar__item"><a aria-current="page" class="is-active" href="/x-dash/components/x-interaction">x-interaction</a></li><li class="site-sidebar__item"><a href="/x-dash/components/x-teaser">x-teaser</a></li></ul></div></div><div class="basic-layout__footer"><footer class="site-footer" role="contentinfo"><div class="site-footer__legal-links"><a href="http://help.ft.com/help/legal-privacy/cookies/" rel="noopener noreferrer" target="_blank">Cookies</a><a href="http://help.ft.com/help/legal-privacy/copyright/copyright-policy/" rel="noopener noreferrer" target="_blank">Copyright</a><a href="http://help.ft.com/help/legal-privacy/privacy/" rel="noopener noreferrer" target="_blank">Privacy</a><a href="http://help.ft.com/help/legal-privacy/terms-conditions" rel="noopener noreferrer" target="_blank">Terms &amp; Conditions</a></div><div class="site-footer__related-links"><a href="https://github.com/financial-times/x-dash" rel="noopener noreferrer" target="_blank">x-dash on GitHub</a><a href="https://slack.com/messages/x/" rel="noopener noreferrer" target="_blank">x-dash on Slack</a></div><p class="site-footer__small-print"><small>Â© THE FINANCIAL TIMES LTD 2018. FT and &#x27;Financial Times&#x27; are trademarks of The Financial Times Ltd</small></p></footer></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-npm-package-jsx","jsonName":"components-x-interaction-e68","path":"/components/x-interaction"};window.dataPath="745/path---components-x-interaction-e-68-744-XRHBJxlSnzFGIB1o032kBBT5p8";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f908e434cdcecf094632.js"],"component---src-templates-npm-package-jsx":["/component---src-templates-npm-package-jsx-4ed2498fa94a50fc81ff.js"],"component---src-templates-documentation-page-jsx":["/component---src-templates-documentation-page-jsx-7f0fa51b3ace27197d93.js"],"component---src-pages-components-jsx":["/component---src-pages-components-jsx-a162ed85940a53a81be1.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-a5cd280b9fed706fd7a9.js"],"component---src-pages-packages-jsx":["/component---src-pages-packages-jsx-d1df72bc585d421ff7e6.js"],"pages-manifest":["/pages-manifest-21fc750f276f1bf9320d.js"]};/*]]>*/</script><script src="/x-dash/webpack-runtime-57aa0895b31d9a853c37.js" async=""></script><script src="/x-dash/app-f908e434cdcecf094632.js" async=""></script><script src="/x-dash/component---src-templates-npm-package-jsx-4ed2498fa94a50fc81ff.js" async=""></script><script src="/x-dash/0-dcdb640fb910f8619568.js" async=""></script></body></html>